{"version":3,"file":"overflow-menu-body.js","names":["html","property","prefix","CDSFloatingMenu","FLOATING_MENU_DIRECTION","NAVIGATION_DIRECTION","OVERFLOW_MENU_SIZE","HostListener","indexOf","carbonElement","customElement","styles","capIndex","index","length","CDSOverflowMenuBody","_decorate","_initialize","_CDSFloatingMenu","constructor","args","F","d","kind","decorators","key","value","BOTTOM","type","Boolean","reflect","MEDIUM","_getNextItem","currentItem","direction","selectorItemEnabled","menuItems","querySelectorAll","currentIndex","nextIndex","_navigate","selected","nextItem","focus","event","open","contains","document","activeElement","connectedCallback","hasAttribute","setAttribute","_get","_getPrototypeOf","prototype","call","updated","changedProperties","has","selectorMenuItem","forEach","item","size","render","_t","_","static"],"sources":["components/overflow-menu/overflow-menu-body.ts"],"sourcesContent":["/**\n * @license\n *\n * Copyright IBM Corp. 2019, 2023\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { html } from 'lit';\nimport { property } from 'lit/decorators.js';\nimport { prefix } from '../../globals/settings';\nimport CDSFloatingMenu, {\n  FLOATING_MENU_DIRECTION,\n} from '../floating-menu/floating-menu';\nimport { NAVIGATION_DIRECTION, OVERFLOW_MENU_SIZE } from './defs';\nimport CDSOverflowMenuItem from './overflow-menu-item';\nimport HostListener from '../../globals/decorators/host-listener';\nimport { indexOf } from '../../globals/internal/collection-helpers';\nimport { carbonElement as customElement } from '../../globals/decorators/carbon-element';\nimport styles from './overflow-menu.scss';\n\n/**\n * @param index The index\n * @param length The length of the array.\n * @returns The new index, adjusting overflow/underflow.\n */\nconst capIndex = (index: number, length: number) => {\n  if (index < 0) {\n    return length - 1;\n  }\n  if (index >= length) {\n    return 0;\n  }\n  return index;\n};\n\n/**\n * Overflow menu body.\n *\n * @element cds-overflow-menu-body\n */\n@customElement(`${prefix}-overflow-menu-body`)\nclass CDSOverflowMenuBody extends CDSFloatingMenu {\n  /**\n   * The menu direction.\n   */\n  @property()\n  direction = FLOATING_MENU_DIRECTION.BOTTOM;\n\n  /**\n   * How the menu is aligned to the trigger button.\n   */\n  @property({ type: Boolean, reflect: true })\n  flipped = false;\n\n  /**\n   * `true` if the menu should be open.\n   *\n   * @private\n   */\n  @property({ type: Boolean, reflect: true })\n  open = false;\n\n  selected: CDSOverflowMenuItem | null = null;\n\n  /**\n   * The overflow menu size.\n   */\n  @property({ reflect: true })\n  size = OVERFLOW_MENU_SIZE.MEDIUM;\n\n  /**\n   * @param currentItem The currently selected item.\n   * @param direction The navigation direction.\n   * @returns The item to be selected.\n   */\n  protected _getNextItem(currentItem: CDSOverflowMenuItem, direction: number) {\n    const { selectorItemEnabled } = this\n      .constructor as typeof CDSOverflowMenuBody;\n    const menuItems = this.querySelectorAll(selectorItemEnabled);\n    const currentIndex = indexOf(menuItems, currentItem);\n    const nextIndex = capIndex(currentIndex + direction, menuItems.length);\n    return nextIndex === currentIndex ? null : menuItems[nextIndex];\n  }\n\n  /**\n   * Navigates through overflow menu items.\n   *\n   * @param direction `-1` to navigate backward, `1` to navigate forward.\n   */\n  protected _navigate(direction: number) {\n    if (this.selected) {\n      const nextItem = this._getNextItem(this.selected, direction);\n      (nextItem as HTMLElement)?.focus();\n    }\n  }\n\n  /**\n   * Handles `keydown` event on the menu body.\n   */\n  @HostListener('keydown')\n  // @ts-ignore: The decorator refers to this method but TS thinks this method is not referred to\n  protected _handleKeydown = async (event: KeyboardEvent) => {\n    const { key } = event;\n    if (this.open) {\n      /**\n       * sets this.selected to focused menu item. the menu item is focused\n       * automatically due to FocusMixin\n       */\n      if (this.contains(document.activeElement)) {\n        this.selected = document.activeElement as CDSOverflowMenuItem;\n      }\n\n      if (key in NAVIGATION_DIRECTION) {\n        this._navigate(NAVIGATION_DIRECTION[key]);\n      }\n\n      if (key === 'Escape') {\n        this.open = false;\n      }\n    }\n  };\n\n  connectedCallback() {\n    if (!this.hasAttribute('role')) {\n      this.setAttribute('role', 'menu');\n    }\n    if (!this.hasAttribute('tabindex')) {\n      // TODO: Should we use a property?\n      this.setAttribute('tabindex', '-1');\n    }\n    super.connectedCallback();\n  }\n\n  updated(changedProperties) {\n    if (changedProperties.has('size')) {\n      const { selectorMenuItem } = this\n        .constructor as typeof CDSOverflowMenuBody;\n      const menuItems = this.querySelectorAll(selectorMenuItem);\n      menuItems.forEach((item) => {\n        item.setAttribute('size', this.size);\n      });\n    }\n\n    super.updated(changedProperties);\n  }\n\n  render() {\n    return html` <slot></slot> `;\n  }\n\n  /**\n   * A selector that will return menu items.\n   */\n  static get selectorMenuItem() {\n    return `${prefix}-overflow-menu-item`;\n  }\n\n  /**\n   * A selector that will return enabled menu items.\n   */\n  static get selectorItemEnabled() {\n    return `${prefix}-overflow-menu-item:not([disabled])`;\n  }\n\n  static styles = styles; // `styles` here is a `CSSResult` generated by custom WebPack loader\n}\n\nexport default CDSOverflowMenuBody;\n"],"mappings":"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"}