{"version":3,"file":"file-uploader-button.js","names":["classMap","LitElement","html","property","customElement","prefix","HostListenerMixin","ifNonEmpty","styles","BUTTON_KIND","BUTTON_SIZE","FORM_ELEMENT_COLOR_SCHEME","TILE_COLOR_SCHEME","CDSFileUploaderButton","_decorate","_initialize","_HostListenerMixin","constructor","args","F","d","kind","key","value","_handleClick","event","_this$shadowRoot","_this$shadowRoot2","target","selectorInput","shadowRoot","querySelector","setAttribute","click","_handleKeyDown","_this$shadowRoot3","_this$shadowRoot4","_handleChange","_this$shadowRoot5","addedFiles","_getFiles","eventChange","dispatchEvent","CustomEvent","bubbles","composed","detail","fileInput","_ref","files","type","dataTransfer","accept","test","Array","from","acceptedTypes","Set","split","prototype","filter","call","name","mimeType","_fileExtensionRegExp$","fileExtensionRegExp","hasFileExtension","fileExtension","undefined","exec","has","decorators","reflect","attribute","PRIMARY","MEDIUM","Boolean","render","disabled","multiple","buttonKind","size","handleChange","labelClasses","buttonClasses","_t","_","static"],"sources":["components/file-uploader/file-uploader-button.ts"],"sourcesContent":["/**\n * @license\n *\n * Copyright IBM Corp. 2020, 2023\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { classMap } from 'lit/directives/class-map.js';\nimport { LitElement, html } from 'lit';\nimport { property, customElement } from 'lit/decorators.js';\nimport { prefix } from '../../globals/settings';\nimport HostListenerMixin from '../../globals/mixins/host-listener';\nimport ifNonEmpty from '../../globals/directives/if-non-empty';\nimport styles from './file-uploader.scss';\nimport { BUTTON_KIND, BUTTON_SIZE } from '../button/defs';\n\nexport { FORM_ELEMENT_COLOR_SCHEME as TILE_COLOR_SCHEME } from '../../globals/shared-enums';\n\n/**\n * File uploader button .\n *\n * @element cds-file-uploader-container\n * @fires cds-file-uploader-button-changed The custom event fired when there is a user gesture to select files to upload.\n */\n@customElement(`${prefix}-file-uploader-button`)\nclass CDSFileUploaderButton extends HostListenerMixin(LitElement) {\n  /**\n   * Handles `click` event on the button.\n   */\n  private _handleClick(event) {\n    event.target.value = null;\n    const { selectorInput } = this.constructor as typeof CDSFileUploaderButton;\n    this?.shadowRoot?.querySelector(selectorInput)?.setAttribute('value', '');\n    (this?.shadowRoot?.querySelector(selectorInput) as HTMLElement).click();\n  }\n\n  /**\n   * Handles `keydown` event on the button.\n   */\n  private _handleKeyDown(event) {\n    const { selectorInput } = this.constructor as typeof CDSFileUploaderButton;\n    if (event.key === 'Enter' || event.key === 'Space') {\n      this?.shadowRoot?.querySelector(selectorInput)?.setAttribute('value', '');\n      (this?.shadowRoot?.querySelector(selectorInput) as HTMLElement).click();\n    }\n  }\n\n  /**\n   * Handles user gesture to select files to upload.\n   *\n   * @param event The event.\n   */\n  private _handleChange(event: Event | DragEvent) {\n    const addedFiles = this._getFiles(event);\n    const { eventChange, selectorInput } = this\n      .constructor as typeof CDSFileUploaderButton;\n    this.dispatchEvent(\n      new CustomEvent(eventChange, {\n        bubbles: true,\n        composed: true,\n        detail: {\n          addedFiles,\n        },\n      })\n    );\n\n    const fileInput = this?.shadowRoot?.querySelector(selectorInput);\n    if (fileInput) {\n      (fileInput as HTMLInputElement).value = '';\n    }\n  }\n\n  /**\n   * @param event The event.\n   * @returns The list of files user chose to upload.\n   */\n  private _getFiles(event: Event | DragEvent) {\n    const { files } =\n      (event.type === 'drop'\n        ? (event as DragEvent).dataTransfer\n        : (event.target as HTMLInputElement)) ?? {};\n    const { accept } = this;\n    if (!accept || !/^(change|drop)$/.test(event.type)) {\n      return Array.from(files ?? []);\n    }\n    const acceptedTypes = new Set(accept.split(' '));\n    return Array.prototype.filter.call(\n      files,\n      ({ name, type: mimeType = '' }) => {\n        const fileExtensionRegExp = /\\.[^.]+$/;\n        const hasFileExtension = fileExtensionRegExp.test(name);\n        const [fileExtension] = !hasFileExtension\n          ? [undefined]\n          : fileExtensionRegExp.exec(name) ?? [];\n\n        return (\n          acceptedTypes.has(mimeType) ||\n          (fileExtension && acceptedTypes.has(fileExtension))\n        );\n      }\n    ) as File[];\n  }\n\n  /**\n   * Button kind.\n   */\n  @property({ reflect: true, attribute: 'button-kind' })\n  buttonKind = BUTTON_KIND.PRIMARY;\n\n  /**\n   * Button size.\n   */\n  @property({ reflect: true })\n  size = BUTTON_SIZE.MEDIUM;\n\n  /**\n   * The file types the file input should accept, separated by space.\n   */\n  @property()\n  accept = '';\n\n  /**\n   * `true` if this drop container should be disabled.\n   */\n  @property({ type: Boolean, reflect: true })\n  disabled = false;\n\n  /**\n   * `true` if this drop container should accept more than one files at once.\n   * Note that even with `false` set here, user _can_ select multiple files one by one.\n   */\n  @property({ type: Boolean, reflect: true })\n  multiple = false;\n\n  /**\n   * The name of the input.\n   */\n  @property({ reflect: true })\n  name = '';\n\n  /**\n   * The shadow DOM slot to put this drop container in.\n   */\n  @property({ reflect: true })\n  slot = 'drop-container';\n\n  render() {\n    const {\n      accept,\n      disabled,\n      multiple,\n      name,\n      buttonKind,\n      size,\n      _handleChange: handleChange,\n    } = this;\n\n    const labelClasses = classMap({\n      [`${prefix}--file-browse-btn`]: true,\n      [`${prefix}--file-browse-btn--disabled`]: disabled,\n    });\n    const buttonClasses = classMap({\n      [`${prefix}--btn`]: true,\n      [`${prefix}--btn--${buttonKind}`]: buttonKind,\n      [`${prefix}--layout--size-${size}`]: size,\n      [`${prefix}--btn--disabled`]: disabled,\n      [`${prefix}--btn--${size}`]: size,\n    });\n    return html`\n      <button\n        type=\"button\"\n        class=\"${buttonClasses}\"\n        @click=\"${this._handleClick}\"\n        @keydown=\"${this._handleKeyDown}\">\n        <slot></slot>\n      </button>\n      <label class=\"${labelClasses}\" for=\"file\"> </label>\n      <input\n        id=\"file\"\n        type=\"file\"\n        class=\"${prefix}--file-input\"\n        tabindex=\"-1\"\n        accept=\"${ifNonEmpty(accept)}\"\n        ?disabled=\"${disabled}\"\n        ?multiple=\"${multiple}\"\n        name=\"${ifNonEmpty(name)}\"\n        @change=\"${handleChange}\" />\n    `;\n  }\n\n  /**\n   * The name of the custom event fired when there is a user gesture to select files to upload.\n   */\n  static get eventChange() {\n    return `${prefix}-file-uploader-button-changed`;\n  }\n\n  /**\n   * A selector that will return the file `<input>`.\n   */\n  static get selectorInput() {\n    return `.${prefix}--file-input`;\n  }\n\n  static styles = styles;\n}\n\nexport default CDSFileUploaderButton;\n"],"mappings":"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"}