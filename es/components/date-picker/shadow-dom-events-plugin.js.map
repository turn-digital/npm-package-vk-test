{"version":3,"file":"shadow-dom-events-plugin.js","names":["on","find","moveDateForKeys","ArrowLeft","Left","ArrowUp","Up","ArrowRight","Right","ArrowDown","Down","moveMonthForKeys","MILLISECONDS_IN_DAY","adjustDate","localDate","date","moveDate","utcDate","Date","UTC","getFullYear","getMonth","getDate","getUTCFullYear","getUTCMonth","getUTCDate","fp","getDateElem","daysContainer","firstElementChild","children","dateObj","getTime","handleKeydown","event","ctrlKey","key","target","dispatchEvent","Object","assign","CustomEvent","bubbles","which","movedDate","movedDateElem","focus","innerDaysContainer","changeMonth","lastElementChild","preventDefault","release","_hCDSCEDatePickerShadowDOMEventsPluginKeydown","init","calendarContainer","register","loadedPlugins","push","onReady","onDestroy"],"sources":["components/date-picker/shadow-dom-events-plugin.ts"],"sourcesContent":["/**\n * @license\n *\n * Copyright IBM Corp. 2019, 2023\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { Instance as FlatpickrInstance } from 'flatpickr/dist/types/instance';\nimport { Plugin } from 'flatpickr/dist/types/options';\nimport on from '../../globals/mixins/on';\nimport Handle from '../../globals/internal/handle';\nimport { find } from '../../globals/internal/collection-helpers';\n\n/**\n * `FlatpickrInstance` with additional properties used for `carbonFlatpickrShadowDOMEventsPlugin`.\n */\nexport interface ExtendedFlatpickrInstanceShadowDOMEventsPlugin\n  extends FlatpickrInstance {\n  /**\n   * The handle for `keydown` event handler in calendar dropdown.\n   */\n  _hCDSCEDatePickerShadowDOMEventsPluginKeydown?: Handle | null;\n}\n\n/**\n * The amount of days to adjust, keyed by the key code.\n */\nconst moveDateForKeys = {\n  ArrowLeft: -1,\n  Left: -1,\n  ArrowUp: -7,\n  Up: -7,\n  ArrowRight: 1,\n  Right: 1,\n  ArrowDown: 7,\n  Down: 7,\n};\n\n/**\n * The amount of months to adjust, keyed by the key code. Used with Ctrl modifier key.\n */\nconst moveMonthForKeys = {\n  ArrowLeft: -1,\n  Left: -1,\n  ArrowUp: -12,\n  Up: -12,\n  ArrowRight: 1,\n  Right: 1,\n  ArrowDown: 12,\n  Down: 12,\n};\n\n/**\n * The number of milliseconds per day.\n */\nconst MILLISECONDS_IN_DAY = 86400000;\n\n/**\n * Adjusts the date with the given amount of days.\n *\n * @param localDate The original date.\n * @param options The options.\n * @param [options.date=0] The amount of days to adjust.\n */\nconst adjustDate = (\n  localDate: Date,\n  { date: moveDate = 0 }: { date?: number }\n) => {\n  const utcDate = new Date(\n    Date.UTC(\n      localDate.getFullYear(),\n      localDate.getMonth(),\n      localDate.getDate()\n    ) +\n      moveDate * MILLISECONDS_IN_DAY\n  );\n  return new Date(\n    utcDate.getUTCFullYear(),\n    utcDate.getUTCMonth(),\n    utcDate.getUTCDate()\n  );\n};\n\n/**\n * @returns\n *   A Flatpickr plugin to handle events.\n *   Some event handlers in Flatpickr won't work is the calendar dropdown is put in shadow DOM, due to event retargetting.\n */\nexport default (): Plugin =>\n  (fp: ExtendedFlatpickrInstanceShadowDOMEventsPlugin) => {\n    const getDateElem = (localDate) =>\n      find(\n        fp.daysContainer!.firstElementChild!.children,\n        ({ dateObj }: any) => localDate.getTime() === dateObj.getTime()\n      );\n\n    /**\n     * Handles `keydown` event.\n     */\n    const handleKeydown = (event: KeyboardEvent) => {\n      const { ctrlKey, key, target } = event;\n      if (key === 'Enter') {\n        target!.dispatchEvent(\n          Object.assign(new CustomEvent('mousedown', { bubbles: true }), {\n            which: 1,\n          })\n        );\n      } else if (!ctrlKey && key in moveDateForKeys) {\n        const { dateObj } = target as any;\n        const movedDate = adjustDate(dateObj, { date: moveDateForKeys[key] });\n        const movedDateElem = getDateElem(movedDate);\n        if (movedDateElem) {\n          movedDateElem.focus();\n        } else {\n          const innerDaysContainer = fp.daysContainer!.firstElementChild!;\n          if (\n            movedDate.getTime() <\n            (innerDaysContainer.firstElementChild as any).dateObj.getTime()\n          ) {\n            fp.changeMonth(-1);\n            // `fp.daysContainer` is updated by `fp.changeMonth()`\n            (\n              fp.daysContainer!.firstElementChild!\n                .lastElementChild as HTMLElement\n            ).focus();\n          } else if (\n            movedDate.getTime() >\n            (innerDaysContainer.lastElementChild as any).dateObj.getTime()\n          ) {\n            fp.changeMonth(1);\n            // `fp.daysContainer` is updated by `fp.changeMonth()`\n            (\n              fp.daysContainer!.firstElementChild!\n                .firstElementChild as HTMLElement\n            ).focus();\n          }\n        }\n        event.preventDefault();\n      } else if (ctrlKey && key in moveMonthForKeys) {\n        fp.changeMonth(moveMonthForKeys[key]);\n        (\n          fp.daysContainer!.firstElementChild!.firstElementChild as HTMLElement\n        ).focus();\n        event.preventDefault();\n      }\n    };\n\n    /**\n     * Releases event listeners used in this Flatpickr plugin.\n     */\n    const release = () => {\n      if (fp._hCDSCEDatePickerShadowDOMEventsPluginKeydown) {\n        fp._hCDSCEDatePickerShadowDOMEventsPluginKeydown =\n          fp._hCDSCEDatePickerShadowDOMEventsPluginKeydown.release();\n      }\n    };\n\n    /**\n     * Sets up event listeners used for this Flatpickr plugin.\n     */\n    const init = () => {\n      release();\n      fp._hCDSCEDatePickerShadowDOMEventsPluginKeydown = on(\n        fp.calendarContainer,\n        'keydown',\n        handleKeydown\n      );\n    };\n\n    /**\n     * Registers this Flatpickr plugin.\n     */\n    const register = () => {\n      fp.loadedPlugins.push('carbonFlatpickrShadowDOMEventsPlugin');\n    };\n\n    return {\n      onReady: [register, init],\n      onDestroy: [release],\n    };\n  };\n"],"mappings":"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"}