{"version":3,"file":"range-plugin.js","names":["rangePlugin","on","config","factory","_objectSpread","position","fp","origRangePlugin","onReady","origOnReady","getDateStrFromInputs","dates","filter","value","d","i","arr","mode","enableTime","indexOf","join","conjunction","l10n","rangeSeparator","handleBlur","event","stopPropagation","firstInput","_input","secondInput","input","isInput","target","valueChanged","getDateStr","relatedTargetIsCalendar","relatedTarget","Node","calendarContainer","contains","setDate","altInput","altFormat","dateFormat","release","_hBXCEDatePickerRangePluginOnBlurFrom","_hBXCEDatePickerRangePluginOnBlurTo","Object","assign","call","ignoredFocusElements","push","map","elem","shadowRoot","Boolean","allowInput","capture"],"sources":["components/date-picker/range-plugin.ts"],"sourcesContent":["/**\n * @license\n *\n * Copyright IBM Corp. 2019, 2024\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n// @ts-nocheck\nimport rangePlugin, { Config } from 'flatpickr/dist/plugins/rangePlugin';\nimport { Instance as FlatpickrInstance } from 'flatpickr/dist/types/instance';\nimport { Plugin } from 'flatpickr/dist/types/options';\nimport on from '../../globals/mixins/on';\nimport Handle from '../../globals/internal/handle';\n\n/**\n * `FlatpickrInstance` with additional properties used for `range` plugin.\n */\nexport interface ExtendedFlatpickrInstanceRangePlugin\n  extends FlatpickrInstance {\n  /**\n   * The handle for `blur` event handler for from date range input.\n   */\n  _hBXCEDatePickerRangePluginOnBlurFrom?: Handle | null;\n\n  /**\n   * The handle for `blur` event handler for to date range input.\n   */\n  _hBXCEDatePickerRangePluginOnBlurTo?: Handle | null;\n}\n\n/**\n * @param config Plugin configuration.\n * @returns\n *   An extension of Flatpickr `rangePlugin` that does the following:\n *\n *   Better ensures the calendar dropdown is always aligned to the `<input>` for the starting date.\n *     Workaround for: https://github.com/flatpickr/flatpickr/issues/1944\n *   Disables the logic in Flatpickr `rangePlugin` that calculates the new range with the old selected date\n *     when user selects a date from calendar dropdown.\n *     We'd like to reset the selection when user re-opens calendar dropdown and re-selects a date.\n *     Workaround for: https://github.com/flatpickr/flatpickr/issues/1958\n *   Disables the logic in Flatpickr `rangePlugin` that closes the calendar dropdown\n *     when it's launched from the `<input>` for the end date and user selects a date.\n *     Workaround for: https://github.com/flatpickr/flatpickr/issues/1958\n *   Ensures that the `<input>` in shadow DOM is treated as part of Flatpickr UI,\n *     by ensuring such `<input>` hits `.contains()` search from `fp.config.ignoredFocusElements`.\n *     Without that, Flatpickr clears the `<input>` when end date hasn't been selected yet (which we don't want).\n */\nexport default (config: Config): Plugin => {\n  const factory = rangePlugin({ position: 'left', ...config });\n  return (fp: ExtendedFlatpickrInstanceRangePlugin) => {\n    const origRangePlugin = factory(fp);\n    const { onReady: origOnReady } = origRangePlugin;\n\n    const getDateStrFromInputs = (dates: Array<string>) => {\n      return dates\n        .filter((value) => value)\n        .filter(\n          (d, i, arr) =>\n            fp.config.mode !== 'range' ||\n            fp.config.enableTime ||\n            arr.indexOf(d) === i\n        )\n        .join(\n          fp.config.mode !== 'range'\n            ? fp.config.conjunction\n            : fp.l10n.rangeSeparator\n        );\n    };\n\n    const handleBlur = (event: FocusEvent) => {\n      event.stopPropagation();\n      const firstInput = fp._input;\n      const secondInput = config.input as HTMLInputElement;\n      const isInput =\n        event.target === firstInput || event.target === secondInput;\n      const valueChanged =\n        getDateStrFromInputs([firstInput.value, secondInput.value]) !==\n        fp.getDateStr();\n      const relatedTargetIsCalendar =\n        event.relatedTarget &&\n        event.relatedTarget instanceof Node &&\n        fp.calendarContainer.contains(event.relatedTarget);\n\n      if (isInput && valueChanged && !relatedTargetIsCalendar) {\n        fp.setDate(\n          [firstInput.value, secondInput.value],\n          true,\n          firstInput === fp.altInput\n            ? fp.config.altFormat\n            : fp.config.dateFormat\n        );\n      }\n    };\n\n    const release = () => {\n      if (fp._hBXCEDatePickerRangePluginOnBlurFrom) {\n        fp._hBXCEDatePickerRangePluginOnBlurFrom =\n          fp._hBXCEDatePickerRangePluginOnBlurFrom.release();\n      }\n      if (fp._hBXCEDatePickerRangePluginOnBlurTo) {\n        fp._hBXCEDatePickerRangePluginOnBlurTo =\n          fp._hBXCEDatePickerRangePluginOnBlurTo.release();\n      }\n    };\n\n    return Object.assign(origRangePlugin, {\n      onReady() {\n        origOnReady.call(this);\n        const { ignoredFocusElements } = fp.config;\n        ignoredFocusElements.push(\n          ...ignoredFocusElements\n            .map((elem) => elem.shadowRoot as any)\n            .filter(Boolean)\n        );\n\n        // Setup event listeners for the blur even on both inputs. In the case\n        // of the first input, we're overriding the blur event handler from\n        // the library to fix it by setting it on the capture phase and then\n        // stopping propagation. This is necessary b/c the library does not take\n        // the range plugin into consideration when it calls setDate.\n        // Workaround for: https://github.com/flatpickr/flatpickr/issues/2918\n        release();\n        if (fp.config.allowInput) {\n          fp._hBXCEDatePickerRangePluginOnBlurFrom = on(\n            fp._input,\n            'blur',\n            handleBlur,\n            { capture: true }\n          );\n          fp._hBXCEDatePickerRangePluginOnBlurTo = on(\n            config.input as HTMLInputElement,\n            'blur',\n            handleBlur,\n            { capture: true }\n          );\n        }\n      },\n    });\n  };\n};\n"],"mappings":"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"}